<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Graph Display</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
      body {
        display: flex;
        flex-wrap: wrap;
        justify-content: space-evenly;
        align-items: center;
        height: 100vh;
        margin: 0;
        background-color: #f4f4f4;
      }

      .chart-container {
        width: 45%;
        margin: 20px;
        background-color: white;
        border-radius: 8px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        overflow: hidden;
      }

      h2 {
        text-align: center;
        margin-bottom: 10px;
      }
    </style>
  </head>
  <body>

    <div class="chart-container">
      <h2>Graph 1</h2>
      <canvas id="myChart1" width="400" height="200"></canvas>
    </div>

    <div class="chart-container">
      <h2>Graph 2</h2>
      <canvas id="myChart2" width="400" height="200"></canvas>
    </div>

    <div class="chart-container">
      <h2>Graph 3</h2>
      <canvas id="myChart3" width="400" height="200"></canvas>
    </div>

    <div class="chart-container">
      <h2>Graph 4</h2>
      <canvas id="myChart4" width="400" height="200"></canvas>
    </div>

    <script>
      async function fetchData(index) {
        try {
          const response = await fetch(`/get_data/${index}`);
          if (!response.ok) {
            throw new Error(`HTTP error! Status: ${response.status}`);
          }
          const data = await response.json();
          return data;
        } catch (error) {
          console.error('Error fetching data:', error.message);
          return { data: [], borderColor: 'red', backgroundColor: 'rgba(255, 0, 0, 0.2)' };
        }
      }

      async function renderChart(id, label, index) {
        const data = await fetchData(index);
        const ctx = document.getElementById(id).getContext("2d");

        const myChart = new Chart(ctx, {
          type: "line",
          data: {
            labels: Array.from({ length: data.data.length }, (_, i) => i + 1), // Assuming labels are 1, 2, 3, ...
            datasets: [
              {
                label: label,
                data: data.data,
                borderColor: data.borderColor,
                backgroundColor: data.backgroundColor,
                borderWidth: 1,
              },
            ],
          },
          options: {
            scales: {
              y: {
                beginAtZero: true,
              },
            },
          },
        });
      }

      window.onload = async function () {
        renderChart("myChart1", "Graph 1", 0);
        renderChart("myChart2", "Graph 2", 1);
        renderChart("myChart3", "Graph 3", 2);
        renderChart("myChart4", "Graph 4", 3);
      };
    </script>
  </body>
</html>
